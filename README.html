<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>README</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
  <link href="stylesheets/pandoc.css" rel="stylesheet">
  <style type="text/css">code{white-space: pre;}</style>
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>
<body>
<!-- doc title / page header -->
<div class="container-fluid">
<div class="row-fluid">
<div class="span4">
<nav id="TOC" class="sidebar-nav sidebar-nav-fixed">
<ul>
<li><a href="#aim_hust-2022">AIM_HUST-2022</a>
<ul>
<li><a href="#简介">简介</a></li>
<li><a href="#环境配置">环境配置</a></li>
<li><a href="#文件结构">文件结构</a></li>
<li><a href="#代码规范">代码规范</a></li>
<li><a href="#设计模式">设计模式</a></li>
<li><a href="#如何使用">如何使用？</a></li>
<li><a href="#算法演示">算法演示</a></li>
<li><a href="#程序框图">程序框图</a></li>
<li><a href="#优化方向">优化方向</a></li>
</ul></li>
</ul>
</nav>
</div>
<div class="span8">
<h1 id="aim_hust-2022">AIM_HUST-2022</h1>
<p>华中科技大学狼牙战队2022赛季步兵自瞄程序。</p>
<h2 id="简介">简介</h2>
<ol type="1">
<li>硬件配置</li>
</ol>
<p>硬件上我们使用大恒相机+5mm焦距镜头,miniPC使用的是NVIDIA Jetson TX2</p>
<ol start="2" type="1">
<li>功能</li>
</ol>
<ul>
<li>自瞄</li>
<li>反陀螺</li>
<li>能量机关</li>
</ul>
<ol start="3" type="1">
<li>部署需要调节的参数有</li>
</ol>
<ul>
<li>传统视觉相机参数，如曝光，增益等</li>
<li>大恒相机ID</li>
<li>相机内参数</li>
<li>相机镜头到枪管的平移向量</li>
<li>USE转串口设备名字</li>
<li>线程延时</li>
<li>传统视觉识别参数，如二值化阈值,灯条装甲板几何约束参数</li>
<li>相机到枪管的旋转角度yaw_bias和pitch_bias(相机安装不可能完全与枪管无旋转)</li>
<li>发射延迟</li>
<li>卡尔曼滤波参数，如测量噪声，过程噪声</li>
<li>强跟踪滤波器参数</li>
<li>卡方检验数</li>
</ul>
<h2 id="环境配置">环境配置</h2>
<ul>
<li>Ubuntu 18.04 LTS</li>
<li>gcc 7.5.0</li>
<li>OpenCV 4.5.1</li>
<li>Eigen非模板类</li>
<li>Ceres</li>
<li>Sophus</li>
<li>LCM</li>
<li>Glog</li>
<li>Jsoncpp</li>
</ul>
<h2 id="文件结构">文件结构</h2>
<p>. ├── auto_start.sh //自启动脚本 ├── CMakeLists.txt ├── README.md └── src ├── armor_detector // 自瞄 │   ├── CMakeLists.txt │   ├── include │   │   ├── ArmorFinder.h │   │   ├── DetectAccelerator.h │   │   ├── Detector.h │   │   ├── EnemyType.h │   │   ├── LightBarFinder.h │   │   ├── NumberClassifier.h │   │   └── TargetBumper.h │   └── src │   ├── ArmorFinder.cpp // 灯条匹配装甲板 │   ├── DetectAccelerator.cpp // ROI提取 │   ├── Detector.cpp // 自瞄子线程 │   ├── LightBarFinder.cpp // 预处理 &amp; 筛选灯条 │   ├── NumberClassifier.cpp // HOG + SVM 数字分类 │   └── TargetBumper.cpp // 优先级判断 ├── AutoAim.cpp // 主程序，生成子线程 ├── AutoAim.h ├── buff // 能量机关 │   ├── CMakeLists.txt │   ├── include │   │   ├── AdaptiveEKF.hpp │   │   ├── buffAngleKalman.h │   │   ├── buffArmorNode.h │   │   ├── buffClassifier.h │   │   ├── buffCompensation.h │   │   ├── buffCurver.h │   │   ├── buffDetector.h │   │   ├── buffEKF.h │   │   ├── buffKalman.h │   │   └── buffPredictor.h │   └── src │   ├── buffAngleKalman.cpp │   ├── buffClassifier.cpp // 能量机关SVM分类器 │   ├── buffCompensation.cpp // 能量机关补偿计算 │   ├── buffCurver.cpp // 正弦曲线拟合 │   ├── buffDetector.cpp // 能量机关识别器 │   ├── buffEKF.cpp // 能量机关EKF角度滤波，已弃用 │   ├── buffKalman.cpp // 能量机关KF角度滤波，已弃用 │   └── buffPredictor.cpp // 能量机关预测器 ├── driver │   ├── CMakeLists.txt │   ├── include │   │   ├── DxImageProc.h │   │   ├── GxCamera.h │   │   ├── GxIAPI.h │   │   ├── SerialPort.h │   │   └── VideoCapture.h │   └── src │   ├── GxCamera.cpp // 大恒相机软件驱动 │   ├── SerialPort.cpp // 串口通信线程 │   └── VideoCapture.cpp // 采集图像线程 ├── lcm // LCM通信模块，用以发送信息给自己电脑debug使用，需要配合QT小程序使用 │   ├── CMakeLists.txt │   ├── example_t.lcm │   ├── exlcm │   │   └── example_t.hpp │   ├── info.hpp │   ├── lcm_module.cpp │   └── lcm_module.h ├── pose_estimate // 位姿估计 │   ├── CMakeLists.txt │   ├── include │   │   ├── AdaptiveEKF.hpp │   │   ├── CTModel.h │   │   ├── ExtendedKalman.hpp │   │   ├── NormalEKF.h │   │   ├── NormalKalman.h │   │   ├── PitchYawFilter.h │   │   ├── PoseSolver.h │   │   ├── Predictor.h │   │   ├── SecondFilter.h │   │   └── STF.hpp //强跟踪滤波器有关文件 │   └── src │   ├── CTModel.cpp // CT运动模型估计小陀螺的旋转，已弃用 │   ├── NormalEKF.cpp // EKF滤波进行状态估计(参考上交) │   ├── NormalKalman.cpp // CV模型进行状态估计，已被EKF代替 │   ├── PitchYawFilter.cpp │   ├── PoseSolver.cpp │   ├── Predictor.cpp │   └── SecondFilter.cpp // 卡尔曼滤波进行低通滤波 └── utils ├── CMakeLists.txt ├── destroy // 部分以后可能有参考价值的弃用代码 │   ├── AdaptiveEKF.hpp │   ├── CAModel.cpp // CA运动模型 │   ├── CAModel.h │   ├── CTModel.cpp // CT旋转估计模型 │   ├── CTModel.h │   ├── README.md │   ├── SingerExtendedFilter.cpp // Singer模型(EKF) │   ├── SingerExtendedFilter.h │   ├── SingerFilter.cpp // Singer模型(KF) │   └── SingerFilter.h ├── include │   ├── Config.h │   ├── LockFreeQueue.hpp // 无锁循环队列 │   ├── Log.h │   ├── Params.h │   └── Timer.h ├── src │   ├── Config.cpp // 配置文件读取 │   ├── Log.cpp // 日志 │   ├── Params.cpp // 参数定义 │   └── Timer.cpp // 计时器，用来计算帧率; 或作为计数器，用来分频 └── tools ├── buff_model.xml // 能量机关SVM模型 ├── init.json // 配置文件 └── svm_numbers.xml // 数字分类SVM模型</p>
<h2 id="代码规范">代码规范</h2>
<table>
<thead>
<tr class="header">
<th>规范</th>
<th>含义</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>首字母大写，单词间大写区分</td>
<td>文件名,类名</td>
<td>ArmorBlob: 即ArmorBlob类</td>
</tr>
<tr class="even">
<td>首字母小写，单词间大写区分</td>
<td>函数名</td>
<td>initHog: 即Hog初始化函数</td>
</tr>
<tr class="odd">
<td>首字母小写，单词以下划线区分</td>
<td>变量</td>
<td>lut_table: LUT表格</td>
</tr>
<tr class="even">
<td>全小写，名词为变量，动词为函数</td>
<td>一些简单变量以及含义明确的函数</td>
<td>Kalman类的predict: 卡尔曼滤波预测过程</td>
</tr>
</tbody>
</table>
<h2 id="设计模式">设计模式</h2>
<p>生产者消费者模式</p>
<h2 id="如何使用">如何使用？</h2>
<ol type="1">
<li></li>
</ol>
<pre><code>    sudo vim /etc/rc.local</code></pre>
<ol start="2" type="1">
<li>将以下代码加在”exit 0”之前,然后保存退出编辑</li>
</ol>
<pre><code>    sh you_dir/auto_start.sh</code></pre>
<ol start="3" type="1">
<li></li>
</ol>
<pre><code>    sudo chmod +x /etc/rc.local</code></pre>
<h2 id="算法演示">算法演示</h2>
<h2 id="程序框图">程序框图</h2>
<p>tips: 需使用mermaid观看流程图</p>
<pre class="mermaid"><code>graph TB
    subgraph Diagram
        subgraph source
            stm32
            Camera

            style stm32 fill:#32f
            style Camera fill:#32f
        end
        subgraph queue
            D1[picture queue]
            D2[serial data queue]

            style D1 fill:#bbf
            style D2 fill:#bbf
        end
        subgraph thread
            subgraph detector
            A(detector start)--&gt;A2[wait for a picture]
            D1--&gt;A2
            A2--&gt;A3[wait for a serial data]
            D2--&gt;A3
            A3--&gt;A4[image process]
            A4--&gt;A5[posture estimate]
            A5--&gt;A6[state estimate]
            A6--&gt;A7[send data to stm32]
            A7--&gt;stm32
            A7--&gt;A8(end a loop)
            A8--&gt;A2
            style A fill:#f9f,stroke:#f92,stroke-width:4px
            style A8 fill:#bbf,stroke:#f66,stroke-width:2px,color:#fff,stroke-dasharray: 5 5
            end

            subgraph camera
            B(camera start)--&gt;B1[wait for image from camera]
            B1--&gt;B2[send data to queue]
            B2--&gt;D1
            B2--&gt;B3(end a loop)
            style B fill:#f9f,stroke:#f92,stroke-width:4px
            style B3 fill:#bbf,stroke:#f66,stroke-width:2px,color:#fff,stroke-dasharray: 5 5
            end
            subgraph serial
            C(serial start)--&gt;C1[wait for serial data]
            C1--&gt;C2[send data to queue]
            C2--&gt;D2
            C2--&gt;C3(end a loop)
            C3--&gt;C1
            style C fill:#f9f,stroke:#f92,stroke-width:4px
            style C3 fill:#bbf,stroke:#f66,stroke-width:2px,color:#fff,stroke-dasharray: 5 5
            end
        end


        stm32--&gt;|send data| C1
        Camera--&gt;|send picture| B1
    end
</code></pre>
<h2 id="优化方向">优化方向</h2>
<ol type="1">
<li>更鲁棒的识别性能</li>
</ol>
<p>如何应对复杂的灯光一直是赛场上令每个RMer都头疼的问题，当前识别主要有两个思路，一个是传统视觉方向，一个是深度学习方向。传统视觉方向对环境光照依赖较高，但逻辑更为简单，且很多误分类可以通过简单设置约束参数完成。深度学习则对灯光更为鲁棒,但是一旦识别出现问题则很难纠正。</p>
<p>传统视觉做鲁棒的主要思路是:更加细致的调参以及数字分类模型的完善，细致的调参可以保证在数字分类之前留下更少的候选装甲板，而数字分类模型则应该能适应灯光的变化，降低分类的错误率。</p>
<hr>
<!-- disqus begin -->
<div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname = 'tzyxpages'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">this is used to edit your name</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">this is used to edit your <span class="logo-disqus">name</span></a>
</div>
<!-- disqus end -->
<!-- google analytics begin -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-23745502-8', 'tzengyuxio.me');
  ga('send', 'pageview');

</script>
<!-- google analytics end -->
</div><!--/row-->
</div><!--/container-->
</body>
</html>
